<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sawari - Live tracking</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <style>
        /* General Body Styles */
        body {
            background-color: #f9fafb;
            font-family: 'Inter', sans-serif;
            margin: 0;
            color: #1f2937;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Reusable Container */
        .container {
            max-width: 80rem;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }

        /* Navbar Styles (reused from index.html) */
        .navbar {
            background-color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .navbar-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 4rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: inherit;
        }

        .logo img {
            height: 6rem;
            width: auto;
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: bold;
            color: #1f2937;
        }

        .nav-links {
            display: none;
            align-items: baseline;
            gap: 1rem;
        }

        .nav-link {
            color: #4b5563;
            text-decoration: none;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-link:hover {
            color: #3b82f6;
        }
        
        .cta-button-nav {
            background: linear-gradient(to right, #3b82f6, #9333ea);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            text-decoration: none;
            transition: all 0.3s;
        }

        .cta-button-nav:hover {
            background: linear-gradient(to right, #2563eb, #7e22ce);
        }

        .mobile-menu-button {
            display: none; /* Simplified for tracking page */
        }
        
        main {
            padding-top: 4rem; /* For fixed navbar */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .tracking-container {
            display: flex;
            flex-grow: 1;
            flex-direction: column;
        }

        @media (min-width: 768px) {
            .tracking-container {
                flex-direction: row;
            }
            .nav-links {
                display: flex;
            }
        }

        .map-wrapper {
            flex-grow: 1;
            min-height: 400px;
            position: relative;
        }
        
        #map {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .sidebar {
            width: 100%;
            background-color: white;
            padding: 1.5rem;
            box-shadow: -4px 0 6px -1px rgba(0,0,0,0.1);
            z-index: 10;
            overflow-y: auto;
            box-sizing: border-box;
        }
        
        @media (min-width: 768px) {
            .sidebar {
                width: 350px;
                flex-shrink: 0;
            }
        }

        .sidebar h2 {
            font-size: 1.5rem;
            margin-top: 0;
        }
        
        .input-group {
            margin-bottom: 1rem;
        }

        .input-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .input-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            box-sizing: border-box;
        }

        .cta-button {
            width: 100%;
            background: linear-gradient(to right, #3b82f6, #9333ea);
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .cta-button:hover {
            background: linear-gradient(to right, #2563eb, #7e22ce);
        }
        
        .tracking-info {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .info-card {
            background-color: #f9fafb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
        }
        
        .info-card h3 {
            margin: 0 0 0.5rem;
            font-size: 1.125rem;
            color: #1f2937;
        }
        
        .info-card p {
            margin: 0;
            font-size: 1rem;
            color: #4b5563;
        }
        
        .info-card .status-ontime {
            color: #059669;
            font-weight: bold;
        }

        .info-card .status-delayed {
            color: #dc2626;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }

        /* Footer */
        .footer {
            background-color: #1f2937;
            color: #9ca3af;
            width: 100%;
        }

        .footer .container {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-links {
            display: flex;
            gap: 1.5rem;
        }

        .footer-links a {
            color: #9ca3af;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: white;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="index.html" class="logo">
                <img src="Street_App_Location_Itinerary_Logo_-removebg-preview.png"alt="Sawari Logo">
            </a>
            <div class="nav-links">
                
                <a href="index.html" class="nav-link">Home</a>
                <a href="index.html#routes" class="nav-link">Routes</a>
                <a href="index.html#features" class="nav-link">Features</a>
                <a href="index.html#support" class="nav-link">Support</a>
                <a href="index.html#about" class="nav-link">About</a>
                <a href="index.html#ai-planner" class="nav-link">Plan Trip with AI</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <div class="tracking-container">
            <!-- Map -->
            <div class="map-wrapper">
                <div id="map"></div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <h2>Track Your Bus</h2>
                <div class="input-group">
                    <label for="bus-number">Enter Bus Number (e.g., PB01A1234)</label>
                    <input type="text" id="bus-number" placeholder="PB01A1234">
                </div>
                <button id="track-btn" class="cta-button">Track Bus</button>

                <div id="tracking-details" class="tracking-info hidden">
                    <div class="info-card">
                        <h3>Current Status</h3>
                        <p id="bus-status" class="status-ontime">On Time</p>
                    </div>
                    <div class="info-card">
                        <h3>Estimated Arrival</h3>
                        <p id="bus-eta">2:25 PM at Sector 44</p>
                    </div>
                     <div class="info-card">
                        <h3>Next Stop</h3>
                        <p id="bus-next-stop">Sector 44, Chandigarh</p>
                    </div>
                    <div class="info-card">
                        <h3>Final Destination</h3>
                        <p>Kharar Bus Stand</p>
                    </div>
                </div>
                 <div id="error-message" class="tracking-info hidden">
                    <div class="info-card">
                       <p>Could not find bus. Please check the number and try again.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                </div>
                <p>&copy; 2024 Sawari. All rights reserved.</p>
            </div>
        </div>
    </footer>


    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // Map Initialization
        const map = L.map('map').setView([28.7041, 77.1025], 11); // Centered on Delhi
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
        }).addTo(map);

        // UI Elements
        const trackBtn = document.getElementById('track-btn');
        const busNumberInput = document.getElementById('bus-number');
        const trackingDetails = document.getElementById('tracking-details');
        const errorMessage = document.getElementById('error-message');
        const busStatus = document.getElementById('bus-status');
        const busEta = document.getElementById('bus-eta');
        const busNextStop = document.getElementById('bus-next-stop');

        // Sample Bus Data
        const sampleBus = {
            id: 'PB01A1234',
            route: [
                { lat: 30.7333, lng: 76.7794, name: "Chandigarh ISBT", time: "2:15 PM" },
                { lat: 30.7042, lng: 76.7570, name: "Sector 44", time: "2:25 PM" },
                { lat: 30.6865, lng: 76.7176, name: "Mohali Phase 7", time: "2:40 PM" },
                { lat: 30.6599, lng: 76.7171, name: "Kharar Bus Stand", time: "3:00 PM" }
            ]
        };
        
        let busMarker = null;
        let routePolyline = null;
        let animationInterval = null;

        // Custom Bus Icon
        const busIcon = L.icon({
            iconUrl: "data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23f03c3c' width='38px' height='38px'%3e%3cpath d='M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z'/%3e%3c/svg%3e",
            iconSize: [38, 38],
            iconAnchor: [19, 38],
            popupAnchor: [0, -38]
        });

        trackBtn.addEventListener('click', () => {
            const busId = busNumberInput.value.toUpperCase();
            
            // Clear previous tracking visuals
            if (animationInterval) clearInterval(animationInterval);
            if (busMarker) map.removeLayer(busMarker);
            if(routePolyline) map.removeLayer(routePolyline);
            trackingDetails.classList.add('hidden');
            errorMessage.classList.add('hidden');

            if (busId === sampleBus.id) {
                startTracking(sampleBus);
            } else {
                errorMessage.classList.remove('hidden');
            }
        });

        function startTracking(bus) {
            trackingDetails.classList.remove('hidden');
            
            const routeCoords = bus.route.map(p => [p.lat, p.lng]);

            // Draw route line
            routePolyline = L.polyline(routeCoords, { color: '#3b82f6', weight: 5 }).addTo(map);
            map.fitBounds(routePolyline.getBounds().pad(0.1));

            // Add markers for all stops
            bus.route.forEach((stop, index) => {
                let popupText = stop.name;
                if (index === 0) {
                    popupText = 'Start: ' + stop.name;
                } else if (index === bus.route.length - 1) {
                    popupText = 'End: ' + stop.name;
                }
                L.marker([stop.lat, stop.lng]).addTo(map).bindPopup(popupText);
            });

            // Initialize bus marker
            busMarker = L.marker(routeCoords[0], { icon: busIcon }).addTo(map);
            
            let currentSegment = 0;
            let segmentProgress = 0;

            animationInterval = setInterval(() => {
                if (currentSegment >= routeCoords.length - 1) {
                    clearInterval(animationInterval);
                    busStatus.textContent = 'Arrived';
                    busStatus.className = 'status-ontime';
                    busEta.textContent = 'Journey Complete';
                    busNextStop.textContent = '-';
                    return;
                }

                const startPoint = L.latLng(routeCoords[currentSegment]);
                const endPoint = L.latLng(routeCoords[currentSegment + 1]);

                // Interpolate position
                const newLat = startPoint.lat + (endPoint.lat - startPoint.lat) * segmentProgress;
                const newLng = startPoint.lng + (endPoint.lng - startPoint.lng) * segmentProgress;
                busMarker.setLatLng([newLat, newLng]);

                segmentProgress += 0.02; // Animation speed

                // Update info panel
                const nextStopIndex = currentSegment + 1;
                busNextStop.textContent = bus.route[nextStopIndex].name;
                busEta.textContent = `${bus.route[nextStopIndex].time} at ${bus.route[nextStopIndex].name}`;

                if(Math.random() > 0.95) { // Randomly make the bus delayed
                     busStatus.textContent = 'Delayed';
                     busStatus.className = 'status-delayed';
                } else {
                     busStatus.textContent = 'On Time';
                     busStatus.className = 'status-ontime';
                }

                if (segmentProgress >= 1) {
                    segmentProgress = 0;
                    currentSegment++;
                }
            }, 100); // Update every 100ms
        }
    </script>
</body>
</html>
